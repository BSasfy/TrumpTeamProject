package commandline;

import java.io.IOException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.Collections;
import java.util.List;
import java.util.Random;

public class GamePlay {

	// records need to be a string //
	
	List<List> shuffledDeck = new ArrayList<List>();
	List<List> playerDeck = new ArrayList<List>(); // Why was it <Card>? //Changed from ArrayList to List to be able to
													// use subLists
	List<List> AIDeck1 = new ArrayList<List>();
	List<List> AIDeck2 = new ArrayList<List>();
	List<List> AIDeck3 = new ArrayList<List>();
	List<List> AIDeck4 = new ArrayList<List>();
	
	List<List> winnersDeck;

	Player human;
	Player AI1;
	Player AI2;
	Player AI3;
	Player AI4;

	Object activePlayer;
	Object winner;

	DeckInAndShuffle cardsIn;

	public GamePlay(DeckInAndShuffle d, Player humanPlayer, Player aI1, Player aI2, Player aI3, Player aI4) {
		cardsIn = d;
		human = humanPlayer;
		AI1 = aI1;
		AI2 = aI2;
		AI3 = aI3;
		AI4 = aI4;

		human.setName("Human");
		AI1.setName("AI1");
		AI2.setName("AI2");
		AI3.setName("AI3");
		AI4.setName("AI4");

	}

	void playgame() throws IOException {
		int chosenAttribute;

		cardsIn.setUpDeck();
		shuffledDeck = cardsIn.getStartDeck();
		dealDeck();
		activePlayer = getActivePlayer();
		List<List> cardsInGame = new ArrayList<List>();
		
		int j = 0; //so that we avoid the problem of having to remove items from the array, carsInGame.add(playerDeck.get(i));
		while(true) { //change true to while players are still in game or something similar.
		// play cards
			
			cardsInGame.clear();//= null so we clear it every round
			cardsInGame.add(playerDeck.get(0));// will it overwrite if we add cards to indexes 0-3 upon draw.
			cardsInGame.add(AIDeck1.get(0));
			cardsInGame.add(AIDeck2.get(0));
			cardsInGame.add(AIDeck3.get(0));
			cardsInGame.add(AIDeck4.get(0));
	
			// display card and choose attribute
			System.out.println("Human Player, your card is: ");
			System.out.println(playerDeck.get(0));
	
			System.out.println(((Player) activePlayer).getName() + "! It's your turn!");
	
			if ((Player) activePlayer == human) {
				chosenAttribute = ((Player) activePlayer).humanChooseAttribute();
			} else {
				chosenAttribute = ((Player) activePlayer).AIChooseAttribute();
			} // Exception Handling needed, if they enter numbers other than 1 or 5, if they
				// enter something other than an int, etc.
	
			System.out.println("The attribute you chose is: " + chosenAttribute);
	
			// compare cards
			List<List> winnerCard = null;
			int max = 0;
	
			for (int i = 0; i < cardsInGame.size(); i++) {
				if (((int) cardsInGame.get(i).get(chosenAttribute)) > max) {
					max = (int) cardsInGame.get(i).get(chosenAttribute);
					winnerCard = cardsInGame.get(i);
					if (i == 0) {
						winner = human;
						winnersDeck = playerDeck;
					} else if (i == 1) {
						winner = AI1;
						winnersDeck = AIDeck1;
					} else if (i == 2) {
						winner = AI2;
						winnersDeck = AIDeck2;
					} else if (i == 3) {
						winner = AI3;
						winnersDeck = AIDeck3;
					} else if (i == 4) {
						winner = AI4;
						winnersDeck = AIDeck4;
					}
				}
			}
	
			// remove cards from decks and add it all to winners
			System.out.println("The cards played in this round were: " + cardsInGame); // checkpoint, delete in final
			System.out.println("The winning card is: " + winnerCard);
			System.out.println("The winner is: " + ((Player) winner).getName());
		
			//removing is an issue with 2D Array. Help: https://stackoverflow.com/questions/1805147/how-to-remove-a-row-in-two-dimensional-array
			/*playerDeck.remove(0); //when we remove does everything shift up one?*/
			
			
			//chose one style or the other
			List<List> playerDeckToRemove = new ArrayList<List>();
			playerDeckToRemove.add(playerDeck.get(0));
			playerDeck.removeAll(playerDeckToRemove);
			
			List<List> AIDeck1ToRemove = new ArrayList<List>();
			AIDeck1ToRemove.add(AIDeck1.get(0));
			AIDeck1.removeAll(AIDeck1ToRemove);
			
			
			AIDeck2.removeAll(cardsInGame.get(2));
			AIDeck3.removeAll(cardsInGame.get(3));
			AIDeck4.removeAll(cardsInGame.get(4));
			
			Collections.shuffle(cardsInGame);
			winnersDeck.add(cardsInGame);
			
			
			//passing activePlayer status
			activePlayer = winner;
			j++;
		}
		
		
		

		// DONE now add all cards to the Player the winnerCard belongs to.
		// DONE pass active status (firstPlayer?)
		// DONE how do we know if someone is eliminated?
		// write statistics
		// what happens if its a draw?
		// Gold Plating: change some of the card values so there are no exactly identical ones? Maybe come up with new card names for the ones that are repeated? At least some of them?
		
		

	}

	Object getActivePlayer() {
		Random rand = new Random();

		int activePlayer = rand.nextInt(4);

		if (activePlayer == 0) {
			return human;
		} else if (activePlayer == 1) {
			return AI1;
		} else if (activePlayer == 2) {
			return AI2;
		} else if (activePlayer == 3){
			return AI3;
		}else {
			return AI4;
		}
	}

	private void dealDeck() {
		for (int i=0; i<8; i++) {
			playerDeck.add(shuffledDeck.get(i));
		}
		
		for (int i=8; i<16; i++) {
			AIDeck1.add(shuffledDeck.get(i));
		}
		
		for (int i=16; i<24; i++) {
			AIDeck2.add(shuffledDeck.get(i));
		}
		
		for (int i=24; i<32; i++) {
			AIDeck3.add(shuffledDeck.get(i));
		}
		
		for (int i=32; i<40; i++) {
			AIDeck4.add(shuffledDeck.get(i));
		}
	}

	void setPlayerDeck(List<List> dealtPlayerDeck) {
		playerDeck = dealtPlayerDeck;
	}

	void setAI1Deck(List<List> dealtAI1Deck) {
		AIDeck1 = dealtAI1Deck;
	}

	void setAI2Deck(List<List> dealtAI2Deck) {
		AIDeck2 = dealtAI2Deck;
	}

	void setAI3Deck(List<List> dealtAI3Deck) {
		AIDeck3 = dealtAI3Deck;
	}

}
